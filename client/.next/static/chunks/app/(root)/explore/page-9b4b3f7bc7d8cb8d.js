(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[712],{3290:function(e,t,s){Promise.resolve().then(s.bind(s,8825))},8825:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return components_ExploreComponent}});var n=s(7437),r=s(2265),i=Object.defineProperty,a=new Map,o=new WeakMap,l=0,c=void 0;r.Component;var u=s(6582),d=s(6004),f=s(1396),h=s.n(f),m=s(4033),g=s(345),p=s(5035),shared_PostStats=e=>{let{post:t,userId:s}=e,i=(0,m.usePathname)(),a=t.likes.map(e=>e.$id),[o,l]=(0,r.useState)(a),[c,u]=(0,r.useState)(!1),{mutate:d}=(0,p.B4)(),{mutate:f}=(0,p.vk)(),{mutate:h}=(0,p.mp)(),{data:E}=(0,p.tZ)(),v=null==E?void 0:E.save.find(e=>e.post.$id===t.$id);(0,r.useEffect)(()=>{u(!!v)},[E]);let handleLikePost=e=>{e.stopPropagation();let n=[...o];n.includes(s)?n=n.filter(e=>e!==s):n.push(s),l(n),d({postId:t.$id,likesArray:n})},handleSavePost=e=>{if(e.stopPropagation(),v)return u(!1),h(v.$id);f({userId:s,postId:t.$id}),u(!0)},S=i.startsWith("/profile")?"w-full":"";return(0,n.jsxs)("div",{className:"flex justify-between items-center z-20 ".concat(S),children:[(0,n.jsxs)("div",{className:"flex gap-2 mr-5",children:[(0,n.jsx)("img",{src:"".concat((0,g.yi)(o,s)?"/assets/icons/liked.svg":"/assets/icons/like.svg"),alt:"like",width:20,height:20,onClick:e=>handleLikePost(e),className:"cursor-pointer"}),(0,n.jsx)("p",{className:"small-medium lg:base-medium",children:o.length})]}),(0,n.jsx)("div",{className:"flex gap-2",children:(0,n.jsx)("img",{src:c?"/assets/icons/saved.svg":"/assets/icons/save.svg",alt:"share",width:20,height:20,className:"cursor-pointer",onClick:e=>handleSavePost(e)})})]})},E=s(680),shared_GridPostList=e=>{let{posts:t,showUser:s=!0,showStats:r=!0}=e,{user:i}=(0,E.SE)();return(0,n.jsx)("ul",{className:"grid-container",children:t.map(e=>(0,n.jsxs)("li",{className:"relative min-w-80 h-80",children:[(0,n.jsx)(h(),{href:"/posts/".concat(e.$id),className:"grid-post_link",children:(0,n.jsx)("img",{src:e.imageUrl,alt:"post",className:"h-full w-full object-cover"})}),(0,n.jsxs)("div",{className:"grid-post_user",children:[s&&(0,n.jsxs)("div",{className:"flex items-center justify-start gap-2 flex-1",children:[(0,n.jsx)("img",{src:e.creator.imageUrl||"/assets/icons/profile-placeholder.svg",alt:"creator",className:"w-8 h-8 rounded-full"}),(0,n.jsx)("p",{className:"line-clamp-1",children:e.creator.name})]}),r&&(0,n.jsx)(shared_PostStats,{post:e,userId:i.id})]})]},e.$id))})},SearchREsults=e=>{let{isSearchFetching:t,searchedPosts:s}=e;return t?(0,n.jsx)(d.Z,{}):s&&s.documents.length>0?(0,n.jsx)(shared_GridPostList,{posts:s.documents}):(0,n.jsx)("p",{className:"text-light-4 mt-10 text-center w-full",children:"No results found"})},components_ExploreComponent=e=>{let{ref:t,inView:s}=function({threshold:e,delay:t,trackVisibility:s,rootMargin:n,root:i,triggerOnce:u,skip:d,initialInView:f,fallbackInView:h,onChange:m}={}){var g;let[p,E]=r.useState(null),v=r.useRef(),[S,P]=r.useState({inView:!!f,entry:void 0});v.current=m,r.useEffect(()=>{let r;if(!d&&p)return r=function(e,t,s={},n=c){if(void 0===window.IntersectionObserver&&void 0!==n){let r=e.getBoundingClientRect();return t(n,{isIntersecting:n,target:e,intersectionRatio:"number"==typeof s.threshold?s.threshold:0,time:0,boundingClientRect:r,intersectionRect:r,rootBounds:r}),()=>{}}let{id:r,observer:i,elements:u}=function(e){let t=Object.keys(e).sort().filter(t=>void 0!==e[t]).map(t=>{var s;return`${t}_${"root"===t?(s=e.root)?(o.has(s)||(l+=1,o.set(s,l.toString())),o.get(s)):"0":e[t]}`}).toString(),s=a.get(t);if(!s){let n;let r=new Map,i=new IntersectionObserver(t=>{t.forEach(t=>{var s;let i=t.isIntersecting&&n.some(e=>t.intersectionRatio>=e);e.trackVisibility&&void 0===t.isVisible&&(t.isVisible=i),null==(s=r.get(t.target))||s.forEach(e=>{e(i,t)})})},e);n=i.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),s={id:t,observer:i,elements:r},a.set(t,s)}return s}(s),d=u.get(e)||[];return u.has(e)||u.set(e,d),d.push(t),i.observe(e),function(){d.splice(d.indexOf(t),1),0===d.length&&(u.delete(e),i.unobserve(e)),0===u.size&&(i.disconnect(),a.delete(r))}}(p,(e,t)=>{P({inView:e,entry:t}),v.current&&v.current(e,t),t.isIntersecting&&u&&r&&(r(),r=void 0)},{root:i,rootMargin:n,threshold:e,trackVisibility:s,delay:t},h),()=>{r&&r()}},[Array.isArray(e)?e.toString():e,p,i,n,u,d,s,h,t]);let x=null==(g=S.entry)?void 0:g.target,y=r.useRef();p||!x||u||d||y.current===x||(y.current=x,P({inView:!!f,entry:void 0}));let I=[E,S.inView,S.entry];return I.ref=I[0],I.inView=I[1],I.entry=I[2],I}(),{data:i,fetchNextPage:f,hasNextPage:h}=(0,p.Yi)(),[m,g]=(0,r.useState)(""),E=function(e,t){let[s,n]=(0,r.useState)(e);return(0,r.useEffect)(()=>{let s=setTimeout(()=>{n(e)},t);return()=>{clearTimeout(s)}},[e,t]),s}(m,500),{data:v,isFetching:S}=(0,p.nl)(E);if((0,r.useEffect)(()=>{s&&!m&&f()},[s,m]),!i)return(0,n.jsx)("div",{className:"flex-center w-full h-full",children:(0,n.jsx)(d.Z,{})});let P=""!==m,x=!P&&i.pages.every(e=>0===e.documents.length);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"explore-inner_container",children:[(0,n.jsx)("h2",{className:"h3-bold md:h2-bold w-full",children:"Search Posts"}),(0,n.jsxs)("div",{className:"flex gap-1 px-4 w-full rounded-lg bg-dark-4",children:[(0,n.jsx)("img",{src:"/assets/icons/search.svg",width:24,height:24,alt:"search"}),(0,n.jsx)(u.I,{type:"text",placeholder:"Search",className:"explore-search",value:m,onChange:e=>{let{value:t}=e.target;g(t)}})]})]}),(0,n.jsxs)("div",{className:"flex-between w-full max-w-5xl mt-16 mb-7",children:[(0,n.jsx)("h3",{className:"body-bold md:h3-bold",children:"Popular Today"}),(0,n.jsxs)("div",{className:"flex-center gap-3 bg-dark-3 rounded-xl px-4 py-2 cursor-pointer",children:[(0,n.jsx)("p",{className:"small-medium md:base-medium text-light-2",children:"All"}),(0,n.jsx)("img",{src:"/assets/icons/filter.svg",width:20,height:20,alt:"filter"})]})]}),(0,n.jsx)("div",{className:"flex flex-wrap gap-9 w-full max-w-5xl",children:P?(0,n.jsx)(SearchREsults,{isSearchFetching:S,searchedPosts:v}):x?(0,n.jsx)("p",{className:"text-light-4 mt-10 text-center w-full",children:"End of posts"}):i.pages.map((e,t)=>(0,n.jsx)(shared_GridPostList,{posts:e.documents},"page-".concat(t)))}),h&&!m&&(0,n.jsx)("div",{ref:t,className:"mt-10",children:(0,n.jsx)(d.Z,{})})]})}},6004:function(e,t,s){"use strict";var n=s(7437),r=s(6264);t.Z=()=>(0,n.jsx)("div",{className:"flex-center w-full animate-spin",children:(0,n.jsx)(r.Z,{})})},6582:function(e,t,s){"use strict";s.d(t,{I:function(){return a}});var n=s(7437),r=s(2265),i=s(345);let a=r.forwardRef((e,t)=>{let{className:s,type:r,...a}=e;return(0,n.jsx)("input",{type:r,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...a})});a.displayName="Input"},680:function(e,t,s){"use strict";s.d(t,{SE:function(){return useUserContext}}),s(7437),s(4033);var n=s(2265);s(9149);let r=(0,n.createContext)({user:{id:"",name:"",username:"",email:"",imageUrl:"",bio:""},isLoading:!1,isAuthenticated:!1,setUser:()=>{},setIsAuthenticated:()=>{},checkAuthUser:async()=>!1}),useUserContext=()=>(0,n.useContext)(r)},9149:function(e,t,s){"use strict";s.d(t,{DO:function(){return createUserAccount},w7:function(){return deleteSavedPost},ts:function(){return getCurrentUser},Mp:function(){return getInfinitePosts},n9:function(){return likePost},TJ:function(){return savePost},cl:function(){return searchPosts},MA:function(){return signInAccount}});var n=s(7332),r=s(2601);let i={url:r.env.APPWRITE_URL||"",projectId:r.env.APPWRITE_PROJECT_ID||"",databaseId:r.env.APPWRITE_DATABASE_ID||"",storageId:r.env.APPWRITE_STORAGE_ID||"",userCollectionId:r.env.APPWRITE_USER_COLLECTION_ID||"",postCollectionId:r.env.APPWRITE_POST_COLLECTION_ID||"",savesCollectionId:r.env.APPWRITE_SAVES_COLLECTION_ID||""},a=new n.KU;a.setEndpoint("https://cloud.appwrite.io/v1"),a.setProject("653b95d241aea5b0243a");let o=new n.mR(a),l=new n.Lg(a);new n.Ke(a);let c=new n.OV(a);async function createUserAccount(e){try{let t=await o.create(n.ID.unique(),e.email,e.password,e.name);if(!t)throw Error;let s=c.getInitials(e.name),r=await saveUserToDB({accountId:t.$id,name:t.name,email:t.email,username:e.username,imageUrl:s});return r}catch(e){return console.log(e),e}}async function saveUserToDB(e){try{let t=await l.createDocument(i.databaseId,i.userCollectionId,n.ID.unique(),e);return t}catch(e){console.log(e)}}async function signInAccount(e){try{let t=await o.createEmailSession(e.email,e.password);return t}catch(e){console.log(e)}}async function getAccount(){try{let e=await o.get();return e}catch(e){console.log(e)}}async function getCurrentUser(){try{let e=await getAccount();if(!e)throw Error;let t=await l.listDocuments(i.databaseId,i.userCollectionId,[n.AE.equal("accountId",e.$id)]);if(!t)throw Error;return t.documents[0]}catch(e){return console.log(e),null}}async function searchPosts(e){try{let t=await l.listDocuments(i.databaseId,i.postCollectionId,[n.AE.search("caption",e)]);if(!t)throw Error;return t}catch(e){console.log(e)}}async function getInfinitePosts(e){let{pageParam:t}=e,s=[n.AE.orderDesc("$updatedAt"),n.AE.limit(9)];t&&s.push(n.AE.cursorAfter(t.toString()));try{let e=await l.listDocuments(i.databaseId,i.postCollectionId,s);if(!e)throw Error;return e}catch(e){console.log(e)}}async function likePost(e,t){try{let s=await l.updateDocument(i.databaseId,i.postCollectionId,e,{likes:t});if(!s)throw Error;return s}catch(e){console.log(e)}}async function savePost(e,t){try{let s=await l.createDocument(i.databaseId,i.savesCollectionId,n.ID.unique(),{user:e,post:t});if(!s)throw Error;return s}catch(e){console.log(e)}}async function deleteSavedPost(e){try{let t=await l.deleteDocument(i.databaseId,i.savesCollectionId,e);if(!t)throw Error;return{status:"Ok"}}catch(e){console.log(e)}}},5035:function(e,t,s){"use strict";s.d(t,{mp:function(){return useDeleteSavedPost},tZ:function(){return useGetCurrentUser},Yi:function(){return useGetPosts},B4:function(){return useLikePost},vk:function(){return useSavePost},nl:function(){return useSearchPosts},dT:function(){return useSignInAccount}});var n,r,i=s(3588),a=s(3923),o=s(4152),l=s(8038);(n=r||(r={})).CREATE_USER_ACCOUNT="createUserAccount",n.GET_CURRENT_USER="getCurrentUser",n.GET_USERS="getUsers",n.GET_USER_BY_ID="getUserById",n.GET_POSTS="getPosts",n.GET_INFINITE_POSTS="getInfinitePosts",n.GET_RECENT_POSTS="getRecentPosts",n.GET_POST_BY_ID="getPostById",n.GET_USER_POSTS="getUserPosts",n.GET_FILE_PREVIEW="getFilePreview",n.SEARCH_POSTS="getSearchPosts";var c=s(9149);let useSignInAccount=()=>(0,i.D)({mutationFn:e=>(0,c.MA)(e)}),useGetPosts=()=>(0,a.N)({queryKey:[r.GET_INFINITE_POSTS],queryFn:c.Mp,getNextPageParam:e=>{if(e&&0===e.documents.length)return null;let t=e.documents[e.documents.length-1].$id;return t},initialPageParam:null}),useSearchPosts=e=>(0,o.a)({queryKey:[r.SEARCH_POSTS,e],queryFn:()=>(0,c.cl)(e),enabled:!!e}),useLikePost=()=>{let e=(0,l.NL)();return(0,i.D)({mutationFn:e=>{let{postId:t,likesArray:s}=e;return(0,c.n9)(t,s)},onSuccess:t=>{e.invalidateQueries({queryKey:[r.GET_POST_BY_ID,null==t?void 0:t.$id]}),e.invalidateQueries({queryKey:[r.GET_RECENT_POSTS]}),e.invalidateQueries({queryKey:[r.GET_POSTS]}),e.invalidateQueries({queryKey:[r.GET_CURRENT_USER]})}})},useSavePost=()=>{let e=(0,l.NL)();return(0,i.D)({mutationFn:e=>{let{userId:t,postId:s}=e;return(0,c.TJ)(t,s)},onSuccess:()=>{e.invalidateQueries({queryKey:[r.GET_RECENT_POSTS]}),e.invalidateQueries({queryKey:[r.GET_POSTS]}),e.invalidateQueries({queryKey:[r.GET_CURRENT_USER]})}})},useDeleteSavedPost=()=>{let e=(0,l.NL)();return(0,i.D)({mutationFn:e=>(0,c.w7)(e),onSuccess:()=>{e.invalidateQueries({queryKey:[r.GET_RECENT_POSTS]}),e.invalidateQueries({queryKey:[r.GET_POSTS]}),e.invalidateQueries({queryKey:[r.GET_CURRENT_USER]})}})},useGetCurrentUser=()=>(0,o.a)({queryKey:[r.GET_CURRENT_USER],queryFn:c.ts})},345:function(e,t,s){"use strict";s.d(t,{cn:function(){return cn},yi:function(){return checkIsLiked}});var n=s(7042),r=s(3986);function cn(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.m)((0,n.W)(t))}let checkIsLiked=(e,t)=>e.includes(t)}},function(e){e.O(0,[943,502,576,703,971,472,744],function(){return e(e.s=3290)}),_N_E=e.O()}]);